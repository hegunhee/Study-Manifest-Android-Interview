## ❓ Q) 36. 커스텀 뷰(custom views)는 어떻게 구현하나요?

---

### 📌 개요
커스텀 뷰는 안드로이드 기본 뷰를 확장하거나 완전히 새로 구현하여 앱의 요구사항에 맞는 독창적인 UI와 기능을 제공하는 방법입니다.  
기존 뷰로 표현하기 어려운 고유한 디자인, 맞춤형 동작, 복합 UI 요소를 구현할 때 활용됩니다.

---

### 🛠 구현 절차

1. **기존 뷰 확장 또는 신규 구현**
   - 단순 도형/그래픽 → `View` 상속
   - 자식 뷰 관리 → `ViewGroup` 상속

2. **생성자 구현**
   - XML과 코드 양쪽에서 사용 가능하도록 3가지 생성자 제공  
     - `Context`  
     - `Context, AttributeSet`  
     - `Context, AttributeSet, defStyleAttr`
   - `AttributeSet`로 XML 속성 초기화

3. **커스텀 속성 정의**
   - `res/values/attrs.xml`에 `<declare-styleable>`로 속성 정의
   - `context.obtainStyledAttributes()`로 읽고 `recycle()` 호출

4. **onMeasure() 재정의**
   - 뷰 크기 계산 로직 구현
   - `MeasureSpec` 모드(`EXACTLY`, `AT_MOST`, `UNSPECIFIED`) 처리

5. **onDraw() 재정의**
   - `Canvas`로 직접 그리기
   - 연산 최소화, 반복 계산 캐싱

6. **상태 및 상호작용 처리**
   - `onTouchEvent()` 오버라이드
   - `invalidate()`/`postInvalidate()`로 화면 갱신 요청

7. **성능 최적화**
   - 불필요한 `onDraw()` 호출 방지
   - 복잡한 연산은 사전 계산

---

### 💻 코드 예시
```kotlin
class CircleView @JvmOverloads constructor(
    context: Context,
    attrs: AttributeSet? = null,
    defStyle: Int = 0
) : View(context, attrs, defStyle) {

    private val paint = Paint().apply {
        color = Color.RED
        isAntiAlias = true
    }

    override fun onDraw(canvas: Canvas) {
        super.onDraw(canvas)
        val radius = min(width, height) / 2f
        canvas.drawCircle(width / 2f, height / 2f, radius, paint)
    }
}
```

---

### 📎 Additional Tips
- **재사용성**: XML 속성을 활용하여 다양한 상황에서 동일 뷰 재사용
- **View 라이프사이클 이해**: `onAttachedToWindow()`와 `onDetachedFromWindow()`에서 리소스 관리
- **터치 이벤트 처리**: 커스텀 제스처는 `GestureDetector`와 함께 사용

---

### 💬 실전 질문
**Q)** XML 레이아웃에서 이전 버전과의 호환성을 보장하면서 커스텀 뷰에 커스텀 속성을 효율적으로 적용하려면 어떻게 해야 하나요

**A)**  
1. `attrs.xml`에 `<declare-styleable>` 정의  
2. XML에서 `<com.example.MyView app:customAttr="value" />` 지정  
3. 생성자에서 `obtainStyledAttributes()`로 읽기  
4. `recycle()` 호출로 메모리 해제

---

### 💡 Pro Tips for Mastery
- **ViewBinding/Databinding**과 커스텀 뷰 연동 시, 속성을 관찰하여 UI 자동 갱신 가능  
- `ViewCompat` API를 활용해 하위 호환성 확보  
- `findViewTreeLifecycleOwner()`를 이용하면 뷰가 Lifecycle에 맞춰 자동으로 리소스를 해제하도록 설계 가능

---
