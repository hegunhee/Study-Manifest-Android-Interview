## Q) 32. 안드로이드 애플리케이션의 프로세스(process)란 무엇이며, 안드로이드 운영 체제는 이를 어떻게 관리하나요?

- 안드로이드에서 프로세스(process): 애플리케이션이 실행되는 환경
- 각 안드로이드 앱은 다른 앱과 격리된 자체 프로세스에서 단일 실행 스레드로 작동하여 시스템 보안, 메모리 관리 및 내결함성(fault tolerance)을 보장
    - 내결함성 : 하나 이상의 오류가 발생하는 경우에도 시스템이 계속 제대로 작동할 수 있도록 하는 속성
    - 하나의 앱 프로세스가 죽더라도 다른 앱 프로세스에 영향이 가지 않음 → OS 수준의 프로세스 격리 덕분
- 안드로이드 프로세스는 리눅스 커널을 사용하여 운영 체제에 의해 관리되며 엄격한 생명주기 규칙을 따른다.
- 기본적으로 동일한 애플리케이션의 모든 컴포넌트는 메인 스레드라고 하는 동일한 프로세스 및 스레드에서 실행된다.

### 안드로이드에서 프로세스 작동 방식

- 안드로이드 애플리케이션이 시작되면 운영 체제는 리눅스 fork() 시스템 함수를 호출하여 해당 앱을 위한 새 프로세스를 생성
- 각 프로세스는 Dalvik 또는 ART(안드로이드 런타임) 가상 머신의 고유 인스턴스에서 실행되어 안전하고 독립적인 실행을 보장
    - 고유 인스턴스?
        - 안드로이드 앱마다 해당 앱 전용의 Android Runtime(ART) 또는 Dalvik VM 인스턴스가 있다는 의미.
        - 앱이 실행될 때마다 새로운 VM 인스턴스를 생성한다. 하나의 앱 프로세스는 자신만 쓰는 독립된 가상 머신 위에서 실행된다.
        - 안드로이드 기기 안에는 여러 개의 작은 가상 머신이 동시에 돌아가고 있다고 보면 된다.
- 안드로이드는 각 프로세스에 고유한 리눅스 사용자 ID(UID)를 할당하여 권한 제어 및 파일 시스템 격리를 포함한 엄격한 보안 경계를 적용

### 애플리케이션 컴포넌트와 프로세스 연결

- 기본적으로 안드로이드 애플리케이션의 모든 컴포넌트는 동일한 프로세스 내에서 실행되며, 대부분의 애플리케이션은 이 표준을 따른다.
- 하지만 개발자는 AndroidManifest.xml 파일의 android:process 속성을 사용하여 프로세스 할당을 커스텀할 수 있다.
- 해당 속성은 `<activity>`, `<service>`, `<receiver>`, `<provider>`와 같은 컴포넌트에 적용될 수 있어, 컴포넌트가 별도의 프로세스에서 실행되거나 선택적으로 프로세스를
  공유할 수 있다.
- `<application>` 요소도 이 속성을 지원하여 모든 컴포넌트의 기본 프로세스를 커스텀하게 정의할 수 있다.

```xml

<service
        android:name=".MyService"
        android:process=":remote"/>
```

이 예제에서 MyService 서비스는 :remote라는 별도의 프로세스에서 실행되어 독립적인 작동과 향상된 내결함성을 가능하게 한다.<br>
또한, 다른 애플리케이션의 컴포넌트가 동일한 리눅스 사용자 ID를 가지고 동일한 인증서로 서명된 경우 동일한 프로세스를 공유할 수 있다.

### 프로세스와 앱 생명주기

안드로이드는 시스템 메모리와 앱의 현재 상태를 기반으로 프로세스 및 앱 생명주기를 관리하며, 엄격한 우선순위 계층을 따른다. 안드로이드 시스템은 메모리를 확보하고 시스템 안정성을 유지하기 위해 우선순위가 낮은
프로세스를 자동으로 종료한다.

프로세스 우선순위는 다음과 같다:

1. 포그라운드 프로세스(Foreground Process): 사용자와 활발하게 상호 작용하며 실행 중인 프로세스. 가장 높은 우선순위의 프로세스이며 거의 종료되지 않는다.
2. 보이는 프로세스(Visible Process): 사용자에게 보이지만 활발하게 상호 작용하지 않는 프로세스(가령, 다이얼로그 뒤의 Activity).
    - 여기서 설명하는 다이얼로그와 뒤의 Activity는 아마 서로 다른 앱인 것 같습니다.
3. 서비스 프로세스(Service Process): 데이터 동기화나 음악 재생과 같은 작업을 수행하는 백그라운드 Service를 실행하는 프로세스
4. 캐시된 프로세스(Cached Process): 더 빠른 재실행을 위해 메모리에 유지되는 유휴 프로세스. 캐시된 프로세스는 우선순위가 가장 낮으며 메모리가 부족할 때 가장 먼저 종료된다.

### 보안 및 권한

- 각 안드로이드 프로세스는 리눅스 보안 모델을 사용하여 샌드박스 처리되어 엄격한 권한 기반 접근 제어를 시행한다.
- 이러한 격리는 안드로이드 권한 시스템을 통해 명시적으로 권한이 부여되지 않는 한 애플리케이션이 다른 프로세스의 데이터에 접근할 수 없도록 보장한다.
- 이 보안 모델은 안드로이드의 멀티태스킹 환경의 기본이며 시스템 안정성과 데이터 개인 정보 보호를 모두 지원한다.

### 💡 Pro Tips for Mastery: Activities, Services, Broadcast Receivers, Content Providers가 안드로이드의 4대 주요 컴포넌트라고 불리는 이유는 무엇인가요?

- Activity, Service, BroadcastReceiver, ContentProvider는 안드로이드 애플리케이션이 시스템 및 다른 애플리케이션과 상호 작용할 수 있도록 하는 필수 구성 요소이기 때문에
  안드로이드의 4대 주요 컴포넌트로 불린다.
- 하지만 해당 컴포넌트들이 4대 주요 컴포넌트로 불리는데는 프로세스와 밀접한 관련이 있기 때문이다.

#### 각 컴포넌트가 안드로이드 프로세스와 어떤 관련이 있는가

1. Activities
    - 사용자가 앱을 열면 시스템은 앱의 프로세스에서 Activity를 시작한다.
    - 프로세스가 종료되면 Activity는 소멸되고, 앱을 다시 시작하면 새 프로세스가 생성된다.
2. Services
    - Service는 사용자 인터페이스 없이 백그라운드 작업을 수행. 애플리케이션이 보이지 않을 때도 실행될 수 있어 음악 재생이나 파일 다운로드와 같은 작업을 허용
    - Service는 앱의 매니페스트에 지정된 android:process 속성에 따라 앱과 동일한 프로세스 또는 별도의 프로세스에서 실행될 수 있다.

3. Broadcast Receivers : 앱이 실행 중이 아니더라도 트리거되어 필요한 경우 안드로이드 시스템이 해당 프로세스를 시작하도록 한다.

4. Content Providers
    - ContentProvider는 공유 애플리케이션 데이터를 관리하여 앱이 중앙 집중식 데이터베이스에서 읽거나 쓸 수 있도록 한다.
    - 이는 프로세스 간 통신을 허용하므로 다른 애플리케이션 간에 데이터를 공유하는 데 사용될 수 있으며, 안드로이드 시스템이 프로세스를 안전하고 효율적으로 관리하도록 요구한다.

#### 안드로이드 프로세스와의 연결

- 이러한 컴포넌트는 안드로이드 시스템이 앱 사용량, 메모리 가용성 및 작업 우선순위에 따라 프로세스를 관리하기 때문에 안드로이드 프로세스와 직접적으로 연결된다.
- 컴포넌트가 트리거되면(가령, Activity 열기 또는 브로드캐스트 수신), 안드로이드 시스템은 아직 실행 중이 아닌 앱의 프로세스를 새롭게 시작할 수 있다.

이는 네 가지 주요 안드로이드 컴포넌트 각각이 안드로이드 OS에서 자체 전용 프로세스를 가질 수 있음을 의미한다.
이 네 가지 컴포넌트는 전용 프로세스에서 실행되도록 구성될 수 있으므로 시스템 수준 기능을 얻게 되어 다른 안드로이드 컴포넌트에 비해 더 강력하고 독립적이다.

이 설계는 백그라운드 실행, IPC 및 시스템 수준 상호 작용을 가능하게 하여 안드로이드 앱이 복잡한 다중 프로세스 작업을 효율적으로 처리할 수 있도록 보장한다.