## Q) 31. 애플리케이션 용량를 어떻게 줄이나요?

- 안드로이드 애플리케이션 용량를 최적화하는 것은 특히 저장 공간이 제한적이거나 인터넷 연결이 느린 사용자의 사용자 경험을 개선하는 데 필수적
- 애플리케이션의 기능과 동작을 손상시키지 않으면서 용량을 줄이기 위해 여러 전략 사용 가능

### 사용하지 않는 리소스 제거하기

- 이미지, 레이아웃 또는 문자열과 같이 사용되지 않는 리소스는 불필요하게 APK 또는 AAB 크기를 증가시킴
- Android Studio의 Lint와 같은 도구로 사용하지 않는 리소스를 제거한 후, build.gradle 파일에서 shrinkResources를 활성화하여 빌드 프로세스 중에 사용되지 않는 리소스를 자동으로
  제거하도록 하자.

```groovy
android {
    buildTypes {
        release {
            minifyEnabled true
            shrinkResources true
        }
    }
}
```

### R8로 코드 축소 활성화하기

- 안드로이드의 기본 코드 축소기 및 최적화 도구인 R8은 사용되지 않는 클래스와 메서드를 제거하며, 코드를 난독화하여 더 컴팩트하게 만든다.
- ProGuard를 적절하게 사용하면 중요한 코드나 리플렉션 기반 라이브러리는 난독화를 생략하고 오동작하지 않도록 보장한다. (예: Retrofit에 대한 방지 코드를 프로가드에 추가하지 않으면 오동작을
  일으킨다.)

```groovy
android {
    buildTypes {
        release {
            minifyEnabled true
            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
        }
    }
}
```

### 리소스 최적화 사용하기

- 벡터 드로어블(Vector Drawables): 확장 가능한 그래픽을 위해 래스터 이미지(가령, PNG, JPEG) 대신에 용량을 덜 차지하는 벡터 드로어블로 대체
    - 백터 드로어블을 kt 파일로 사용하면 이미지를 더 빠르게 로딩할 수 있다. (참조 : https://www.youtube.com/watch?v=E6PoIYC9aH4)
- 이미지 압축: TinyPNG 또는 ImageMagick과 같은 도구를 사용하여 눈에 띄는 품질 손상 없이 래스터 이미지를 압축
- WebP 형식: 이미지를 PNG 또는 JPEG보다 압축률이 좋은 WebP 형식으로 변환

```kotlin
android {
    defaultConfig {
        vectorDrawables.useSupportLibrary = true
    }
}
```

### Android App Bundles (AAB) 사용하기

- Android App Bundle (AAB) 형식으로 전환하면 Google Play가 개별 기기에 맞는 최적화된 APK를 제공 가능
- 이는 특정 구성(가령, 화면 밀도, CPU 아키텍처 또는 언어)에 필요한 리소스와 코드만 포함하여 앱 용량을 줄인다.

```kotlin
android {
    bundle {
        density {
            // 화면 해상도(dpi)에 따라 리소스를 분리. 앱에 모든 해상도에 대한 리소스(drawable-hdpi, -xhdpi, -xxhdpi 등) 다 넣지 않고, 기기의 화면 밀도에 맞는 리소스만 포함
            enableSplit = true
        }
        abi {
            // CPU 아키텍처(ABI)에 따라 native 라이브러리를 분리. 예) arm64 기기 → arm64-v8a용 .so 라이브러리만 포함.
            enableSplit = true
        }
        language {
            // 언어 리소스를 분리. 사용자가 선택한 언어(values-ko, values-en, values-ja 등)만 포함
            enableSplit = true
        }
    }
}
```

### 불필요한 의존성 제거하기

- 프로젝트의 의존성을 검토하고 사용되지 않거나 중복되는 라이브러리를 제거하기 위해, Android
  Studio의 [Gradle Dependency Analyzer](https://www.jetbrains.com/help/idea/work-with-gradle-dependency-diagram.html#)를
  사용하여 무거운 라이브러리 및 전이 의존성(transitive dependencies)을 식별할 수 있다.

### 네이티브 라이브러리 최적화하기

앱에 네이티브 라이브러리가 포함된 경우 다음 전략을 사용하여 앱 용량을 줄일 수 있다.

- 사용하지 않는 아키텍처 제외: build.gradle 파일의 abiFilters 옵션을 사용하여 필요한 ABI만 포함
- 디버그 심볼 제거: stripDebugSymbols를 사용하여 네이티브 라이브러리에서 디버깅 심볼을 제거

```groovy
android {
    defaultConfig {
        ndk {
            abiFilters "armeabi-v7a", "arm64-v8a" // 필요한 ABI만 포함
        }
    }
    packagingOptions {
        exclude "**/lib/**/*.so.debug"
    }
}
```

### Proguard 규칙을 구성하여 디버그 정보 줄이기

디버깅 메타데이터는 최종 APK 또는 AAB에 불필요한 무게를 더한다. proguard-rules.pro 파일을 구성하여 이러한 정보를 제거한다.

```proguard
-dontwarn com.example.unusedlibrary.**
-keep class com.example.important.** { *; }
```

### 동적 기능(Dynamic Features) 사용하기

동적 기능 모듈을 사용하면 자주 사용되지 않는 기능을 주문형 모듈(해당 기능이 필요한 경우 설치)로 분리하여 앱을 모듈화 가능하다. → 초기 다운로드 옹량을 줄이는 데 도움

```groovy
// app/build.gradle (Groovy DSL)
android {
    dynamicFeatures = [":feature1", ":feature2"]
}
```

### 앱 내 대용량 애셋 피하기

- 비디오나 고해상도 이미지와 같은 대용량 애셋은 콘텐츠 전송 네트워크(CDN)에 호스팅하고 런타임에 동적으로 로드
- 미디어 콘텐츠는 앱과 함께 번들링하는 대신 스트리밍을 사용
