## Q) 38. View 시스템의 무효화(invalidation)란 무엇인가요?

- 무효화(Invalidation)는 View를 다시 그려야 함을 표시하는 프로세스입니다.
- UI에 변경이 발생했을 때, 시스템이 화면을 최신 상태로 갱신하도록 하는 안드로이드 View 시스템의 기본 메커니즘입니다.
- View가 무효화되면 다음 드로잉 주기에서 해당 부분을 다시 그리게 됩니다.

### 무효화 작동 방식

1. View에서 invalidate() 또는 postInvalidate()를 호출하면 무효화가 트리거됩니다.
2. 시스템은 View를 더티(dirty) 상태로 표시합니다.
3. 이후 프레임에서 드로잉 패스가 실행되어, onDraw()가 호출되며 View가 다시 그려집니다.
4. 위치, 크기, 모양 등이 변경되었을 때 이를 통해 UI가 최신 상태로 갱신됩니다.

### 💡 Additional Tips

- 무효화는 모든 변경마다 즉시 다시 랜더링 하는 대신, 개발자나 시스템에 의해 적절한 타이밍에 갱신하도록 제한해 성능을 최적화합니다.
- 만약 자동 View 업데이트가 허용된다면 불필요한 렌더링이 발생해 성능 저하가 큽니다.
- Jetpack Compose에서는 별도의 무효화 없이 상태 변화에 따라 UI가 자동 갱신되므로, 성능 관리에 더 주의가 필요합니다.

### 무효화를 위한 주요 메서드

1. invalidate()
    1. 단일의 View를 무효화하는 데 사용됩니다.
    2. View를 더티로 표시하여 시스템이 다음 레이아웃 패스 중에 다시 그리도록 신호를 보냅니다.
    3. View를 즉시 다시 그리는 것이 아니라 다음 프레임을 위해 예약합니다.
2. invalidate(Rect dirty) : invalidate()의 오버로드된 버전으로, 다시 그려야 하는 View 내의 특정 직사각형 영역만 무효화합니다.
3. postInvalidate()
    1. UI 스레드가 아닌 스레드에서 View를 무효화하는 데 사용됩니다.
    2. 무효화 요청을 메인 스레드에 게시하여 스레드 안전성을 보장합니다.

### invalidate()를 사용하여 커스텀 View 업데이트하기

아래는 상태가 변경될 때 UI를 다시 그리기 위해 invalidate() 메서드가 사용되는 커스텀 View의 예시입니다.

```kotlin
class CustomView(context: Context) : View(context) {
    private var circleRadius = 50f
    private val paint = Paint().apply { color = Color.RED } // Paint 객체 미리 생성

    override fun onDraw(canvas: Canvas) {
        super.onDraw(canvas)
        // 현재 반지름으로 원 그리기
        canvas.drawCircle(width / 2f, height / 2f, circleRadius, paint)
    }

    fun increaseRadius() {
        circleRadius += 20f
        invalidate() // View를 다시 그려야 함으로 표시
    }
}
```

### 무효화 모범 사례

- 특정 영역만 다시 그리려면 invalidate(Rect dirty) 사용
- 애니메이션이나 복잡한 레이아웃에서는 불필요한 invalidate() 호출을 피함
- 백그라운드 스레드에서는 반드시 postInvalidate()를 사용 → 업데이트가 메인 스레드에서 안전하게 발생하도록 보장합니다.
